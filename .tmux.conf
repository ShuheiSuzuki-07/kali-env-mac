# ---------------------------------------------------------------------------- #
# basic
# ---------------------------------------------------------------------------- #

# copy
set-option -g mouse on
bind-key -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind-key -n WheelDownPane select-pane -t= \; send-keys -M
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# コピーモードをvi風にする
setw -g mode-keys vi

# プレフィックスキーをctrl+aに変更
set -g prefix C-a

# デフォルトのプレフィックスキーctrl+bを解除
unbind C-b

# プレフィックスキー+^でペインを垂直分割する
bind h split-window -h

# プレフィックスキー+-でペインを水平分割する
bind v split-window -v

# 256色モードを有効化
set-option -g default-terminal screen-256color
set -g terminal-overrides 'xterm:colors=256'

# ステータスラインの文字色、背景色を変更
setw -g status-style fg=colour255,bg=colour234

# キーボード側が左から 1,2... と並んでいるので、
# キーボード位置に合わせてウィンドウに1から番号振ると分かりやすい
# でないと 0 だけ右、次の1は左、みたいにややこしい
set-option -g base-index 1
set-option -g pane-base-index 1

# ---------------------------------------------------------------------------- #
# mapping
# ---------------------------------------------------------------------------- #

# <prefix> + r で勝手に .tmux.conf を読み込んでくれる
# これだけはあった方が良いぞ！
# from http://d.hatena.ne.jp/kiririmode/20120321/p1
bind-key r source-file ~/.tmux.conf\; display-message "$HOME/.tmux.conf reloaded!"

# tmux-yank でコピーの選択開始が動かなくなってた？みたいなので、
# 手動で bind-key の設定しちゃう（後述）
bind-key -T copy-mode-vi 'v' send-keys -X  begin-selection

# ---------------------------------------------------------------------------- #
# plugins
# ---------------------------------------------------------------------------- #

# プラグインを管理するためのプラグイン
# 手動で読み込む必要あり！
# <prefix> + i で指定されているプラグインをインストール
# <prefix> + u でアップデート
set-option -g @plugin "tmux-plugins/tpm"

# セッションを保持してくれるプラグイン
# https://github.com/tmux-plugins/tmux-resurrect
# <prefix> + Ctrl-s でセッション保存
# <prefix> + Ctrl-r で復元（リストア）
set-option -g @plugin "tmux-plugins/tmux-resurrect"

# さらに勝手にセッション保持してくれるプラグイン
# https://github.com/tmux-plugins/tmux-continuum
# @continuum-save-interval を指定することで、保持する間隔を指定できる
set-option -g @plugin "tmux-plugins/tmux-continuum"
set -g @continuum-save-interval 10

# ファイルツリーが見られるやつ
# https://github.com/tmux-plugins/tmux-sidebar
# <prefix> + <Tab> で表示
# もう一度 <prefix> + <Tab> を押すか、そのペインに移動してから q で閉じる
set-option -g @plugin "tmux-plugins/tmux-sidebar"

# vi のキーバインドでペイン移動できちゃうやつ
# https://github.com/tmux-plugins/tmux-pain-control
# 結局 tmux のペイン移動を覚える必要があるので、 vi に合わせておくと脳のコスト下がる
set-option -g @plugin "tmux-plugins/tmux-pain-control"

# 黒い画面からのコピペ
# https://github.com/tmux-plugins/tmux-yank
# <prefix> + y で画面まるまるヤンク（コピー）できる
# 実際は画面全体じゃなく部分的にコピーすることが大半なので、
# <prefix> + [ でコピーモードに切り替えてから、 v を押して選択し y でコピー
set-option -g @plugin 'tmux-plugins/tmux-yank'

# プラグイン実行
run-shell "~/.tmux/plugins/tpm/tpm"


# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
